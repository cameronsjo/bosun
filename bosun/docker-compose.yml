# Bosun - GitOps for Docker Compose
# Deploy this on Unraid to enable GitOps deployments

services:
  bosun:
    image: ghcr.io/cameronsjo/bosun:latest
    container_name: bosun
    restart: unless-stopped
    environment:
      TZ: America/Chicago
      # Repository configuration
      BOSUN_REPO_URL: git@github.com:cameronsjo/dotfiles.git
      BOSUN_REPO_BRANCH: main
      # Polling interval in seconds (1 hour)
      BOSUN_POLL_INTERVAL: "3600"
      # HTTP port for webhooks and health
      PORT: "8080"
      # Webhook signature validation (set via .env or secrets)
      WEBHOOK_SECRET: ${WEBHOOK_SECRET}
      # Alerting (optional)
      DISCORD_WEBHOOK_URL: ${DISCORD_WEBHOOK_URL}
      # Dry run mode (set to "true" for testing)
      DRY_RUN: "false"
      # SOPS age key file
      SOPS_AGE_KEY_FILE: /config/age-key.txt
    volumes:
      # Age key for SOPS decryption
      - /mnt/user/appdata/bosun/age-key.txt:/config/age-key.txt:ro
      # SSH deploy key for git operations (optional, for private repos)
      - /mnt/user/appdata/bosun/ssh:/home/bosun/.ssh:ro
      # Docker socket for container operations
      - /var/run/docker.sock:/var/run/docker.sock:ro
      # Persistent data
      - /mnt/user/appdata/bosun/logs:/app/logs
      - /mnt/user/appdata/bosun/backups:/app/backups
      - /mnt/user/appdata/bosun/repo:/app/repo
    networks:
      - proxynet
    labels:
      - homepage.group=Infrastructure
      - homepage.name=Bosun
      - homepage.icon=mdi-anchor
      - homepage.description=GitOps deployment automation
    # Health check is built into the image

networks:
  proxynet:
    external: true
